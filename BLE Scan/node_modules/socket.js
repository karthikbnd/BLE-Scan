var noble = require('noble');
console.log('noble');
//replace localhost with your server's IP;
var socket = require('socket.io-client')('http://localhost/scanner');

//replace with your hardware address
var addressToTrack = 'e8704d31867e'; 

socket.on('connect', function(){  
  console.log('connected to server');
});

noble.on('discover', function(peripheral){
  if(peripheral.uuid == addressToTrack){
    socket.emit('deviceData', {mac: peripheral.uuid, rssi:peripheral.rssi});    
  }
});

//noble.startScanning([], true) 
noble.on('stateChange', function(state) {
  if (state === 'poweredOn') {
    noble.startScanning([], true, function(error) {
      if (error) {
        console.log('error ', error);
      };
     console.log('started scanning.\ncurrent state:', state);
    });
  } else {
    console.log('stopped scanning. current state: ', state);
    process.exit();
    noble.stopScanning(); 
  }
});
