var awsIot = require('aws-iot-device-sdk');

var thingShadows = awsIot.thingShadow({
   keyPath: '/home/reply/certs/private.pem.key',
  certPath: '/home/reply/certs/certificate.pem.crt',
    caPath: '/home/reply/certs/root-CA.crt',
  clientId: 'myAwsClientId',
    region: 'eu-west-1'
});

var state = {"state":{"reported":{"on":false}}};

thingShadows.on('connect', function() {
    thingShadows.register( 'motor' );
	
	setTimeout( function() {
       thingShadows.get('motor');
       console.log('>motor< get. Waiting for 2 seconds...');
       }, 2000 );
});

thingShadows.on('status', 
    function(thingName, stat, clientToken, stateObject) {
       console.log('received '+stat+' on '+thingName+': '+
                   JSON.stringify(stateObject));
	   if (stateObject.state.delta != null) {
		   state.state.reported.on = stateObject.state.delta.on;
		   thingShadows.update('motor', state);
	   }
    });

thingShadows.on('delta', 
    function(thingName, stateObject) {
       console.log('received delta '+' on '+thingName+': '+
                   JSON.stringify(stateObject));
    });

thingShadows.on('timeout',
    function(thingName, clientToken) {
       console.log('received timeout '+' on '+thingName+': '+
                   clientToken);
    });
